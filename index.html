<!DOCTYPE html>
<html lang="en">
<head>
  <title>Interactive Sandbox</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Unica+One|Vollkorn&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
  <script src="./libraries/katex.min.js"></script>
  <script src="./libraries/p5.min.js"></script>
  <script src="./libraries/marked.min.js"></script>
  <script src="./libraries/vue.js"></script>
  <script src="./libraries/vue-observe-visibility.min.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css">
  <meta name="description" content="Interactive Sandbox" />

</head>
<body>

<div id="root" class="container">

<md>
# Interactive Sandbox
### A Template for Creating Explorable Documents With p5.js

This is some text written in markdown. It can include [links](https://aatishb.com/stringmath/), or equations like $x^2 + y^2 = z^2$. Here's the [source code](https://github.com/aatishb/interactivesandbox/blob/main/index.html) for this page.

## A p5 Animation

You can embed a p5 interactive with sliders.
</md>

<!-- variables and sliders are defined at the bottom of the page -->
<animation
:variables="sketch1.variables"
:sliders="sketch1.sliders"
:code="`
p.setup = function() {
  p.createCanvas(600, 400);
  p.textAlign(p.CENTER, p.CENTER);
};



p.draw = function() {
  if (parent.isVisible) { // only update draw loop when canvas is visible
    p.background(0);
    p.fill('gray');
    p.stroke('gray');
    p.strokeWeight(1);
    let base = p.height * 0.8;
    // variables.horizon = p.mouseY;
    p.line(0,variables.horizon,p.width,variables.horizon); //draw horizon line
    p.line(0,base,p.width,base); // draw base line

    let num;
    let y;
    if (variables.state === 0) { // the real (harmonic) sequence
      num = 0;
      while (num < 50) {
        y = base + (variables.horizon - base)*(1 - 6*p.pow(num+6,-1));
        p.stroke(150);
        p.line(0, y, p.width, y);
        num = num +1;
      }
    }
    else {   // and here is the fake (geometric) sequence
      num = 0;
      while (num < 20) {
        let partial_sum = (0.75)*(1 - p.pow(variables.ratio,num+1))/(1-variables.ratio);
        y = base + (variables.horizon - base)*(partial_sum/5.25);
        p.line(0, y, p.width, y);
        num = num +1;
      }
    }

    variables.vp = p.mouseX;
    let vanishing_point = p.createVector(variables.vp,variables.horizon);
    num = 0;
    while (num < 50) {
      p.drawSegment(vanishing_point, p.createVector((.425 - (.15 * num)) * p.width,base), 150);
      p.drawSegment(vanishing_point, p.createVector((.575 + (.15 * num)) * p.width,base), 150);
      num = num + 1;
    }

    p.fill('black');
    p.stroke('black');
    p.rect(0, 0, p.width, y);

    p.noStroke();
    p.fill('green');
    if (variables.state == 0) {
      p.text('Harmonic Progression', p.width/2, p.height - 30);
    } else {
      p.text('Geometric Progression', p.width/2, p.height - 30);
    }



  }
};


p.mouseClicked = function() {
  if (variables.state === 0) {
    variables.state = 1;
  } else {
    variables.state = 0;
  }
};


// draw an arrow for a vector at a given base position
p.drawSegment = function(base, vec, myColor) {
  p.push();
  p.stroke(myColor);
  p.strokeWeight(1);
  p.fill(myColor);
  p.line(base.x, base.y, vec.x, vec.y);
  p.pop();
}
`">
</animation>

<md>
Here's another p5 interactive. Try moving your mouse over it.
</md>

<!-- sketch variables are defined at the bottom of the page -->

Red: {{sketch2.r}} <input type="range" min="0" max="255" step="1" v-model="sketch2.r"></input> 
Green: {{sketch2.g}} <input type="range" min="0" max="255" step="1" v-model="sketch2.g"></input> 
Blue: {{sketch2.b}} <input type="range" min="0" max="255" step="1" v-model="sketch2.b"></input> 

<p5 :vars="sketch2">

  p.setup = function() {
    p.createCanvas(600, 400);
  };

  p.draw = function() {
    if (parent.isVisible) { // only update draw loop when canvas is visible
      p.background(vars.r, vars.g, vars.b);
      p.fill(255 - vars.r, 255 - vars.g, 255 - vars.b);
      p.circle(p.mouseX, p.mouseY, 100);
    }
  };
</p5>


<md>
Try changing the code or adding more interactives! (Remember to write the p5 code in [instance mode](https://github.com/processing/p5.js/wiki/Global-and-instance-mode).)
</md>

</div>

<!-- here we define data accessible throughout the page -->
<script>
let data = {

  sketch1: {
    variables: {x: 0.5, y: 0.5, r: 50, horizon: 50, state: 1, ratio: 0.75, vp: 300},
    sliders: {
      // horizon: ['horizon position', 0, 200, 1],
      // vp: ['vanishing point position', 0, 600, 1],
      // state: ['state', 0, 1, 1],
      ratio: ['common ratio', .75 , .84, .01],
    }
  },

  sketch2: {
    r: 60, 
    g: 20, 
    b: 90
  },

};
</script>
<!-- vue-definitions.js runs vue.js and defines the components -->
<script src="vue-definitions.js"></script>

</body>
</html>
